# PRD: PDF Export for Chat Responses

## Overview

Add the ability for users to export individual assistant responses to PDF. Each PDF includes the user's question, the full response with formatting, tool calls, citations, and a footer noting the source.

## Goals

1. **Easy sharing** - Users can save and share specific answers as professional-looking PDFs
2. **Complete context** - Include the question, response, metadata, and attribution
3. **Preserves formatting** - Maintain markdown rendering, code blocks, lists, etc.

## User Flow

1. User receives a response from the agent
2. User clicks "ğŸ“„" download button on the assistant message bubble
3. PDF is generated and downloaded automatically
4. Filename: `faa-agent-response-{timestamp}.pdf`

## PDF Content Structure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Question                                        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€                                       â”‚
â”‚  [User's original question text]                 â”‚
â”‚                                                  â”‚
â”‚  Response                                        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€                                       â”‚
â”‚  [Full markdown-rendered response]               â”‚
â”‚                                                  â”‚
â”‚  Tool Calls (if any)                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€                                       â”‚
â”‚  â€¢ search_indexed_content: âœ“                    â”‚
â”‚  â€¢ fetch_cfr_section: âœ“                         â”‚
â”‚                                                  â”‚
â”‚  Citations (if any)                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€                                       â”‚
â”‚  Â§25.1309, AC 20-158, ...                       â”‚
â”‚                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Generated by FAA Certification Agent            â”‚
â”‚  https://faa.certification.help                  â”‚
â”‚  [timestamp]                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Technical Design

### Dependencies

Add to `frontend/package.json`:
```json
"html2pdf.js": "^0.10.2"
```

### New Files

#### `frontend/src/exportPdf.ts`

Utility module for PDF generation:

```typescript
interface ExportOptions {
  question: string;           // User's question
  response: string;           // Assistant's markdown response
  toolCalls?: ToolCall[];     // Tool operations performed
  citations?: string[];       // Regulatory references
  timestamp: Date;            // Response timestamp
  agentName: string;          // "FAA Certification Agent"
  agentUrl: string;           // "https://faa.certification.help"
}

exportToPdf(options: ExportOptions): Promise<void>
```

**Implementation:**
1. Create a hidden DOM element with styled content
2. Use html2pdf.js to convert to PDF
3. Trigger download with formatted filename
4. Clean up temporary DOM element

### Modified Files

#### `frontend/src/MessageBubble.tsx`

Add download button to assistant messages:
- Position: Top-right corner of message bubble
- Icon: "ğŸ“„" or download icon
- Behavior: onClick triggers exportToPdf()
- Requires: Access to previous user message for question context

#### `frontend/src/styles.css`

Add styles:
- `.download-btn` - Button styling (subtle, appears on hover)
- `.pdf-export-container` - Hidden container for PDF generation
- Print-friendly styles for PDF content

### Filename Format

```
{agent}-response-{YYYYMMDD-HHmmss}.pdf

Examples:
- faa-agent-response-20260124-143052.pdf
- nrc-agent-response-20260124-143052.pdf
```

### Agent-Specific Branding

Use existing `branding` config to customize:
- Agent name in footer
- Agent URL in footer
- Primary color for headers

## Implementation Steps

1. Add `html2pdf.js` dependency to package.json
2. Create `frontend/src/exportPdf.ts` with PDF generation logic
3. Create TypeScript declaration for html2pdf.js
4. Update `MessageBubble.tsx` to accept question prop and add download button
5. Update `App.tsx` to pass previous user message to MessageBubble
6. Add CSS styles for download button and PDF content

## Success Criteria

- [ ] Download button appears on assistant messages
- [ ] Clicking button downloads a PDF
- [ ] PDF includes question, response, tool calls, citations
- [ ] PDF has footer with agent name, URL, timestamp
- [ ] Markdown formatting preserved in PDF
- [ ] Works for FAA, NRC, and DoD agents
